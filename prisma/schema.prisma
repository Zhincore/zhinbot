datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

// #### MAIN ####

model Guild {
  id String @id

  members Member[]

  // Birthdays
  bdayAlertTime    String?
  bdayAlertChannel String?
  bdayAlertPing    String?

  // Player
  playerChannel String?

  // Selfroles
  autorole String?

  // Modules
  activity  Activity[]
  aiConfig  AIConfig?
  modConfig ModConfig?
  warnings  Warning[]
}

model Member {
  id      String
  guild   Guild  @relation(fields: [guildId], references: [id], onDelete: Cascade)
  guildId String

  activity Activity[]
  birthday Birthday?  @relation(fields: [id], references: [userId])
  warnings Warning[]

  @@id([guildId, id])
}

// #### MODULES ####

// ## Activity ##
model Activity {
  guild     Guild    @relation(fields: [guildId], references: [id], onDelete: Cascade)
  guildId   String
  member    Member   @relation(fields: [guildId, userId], references: [guildId, id], onDelete: Cascade)
  userId    String
  timestamp DateTime @default(now()) @db.Date

  @@id([guildId, userId, timestamp])
}

// ## AI ##
model AIConfig {
  guild     Guild   @relation(fields: [guildId], references: [id], onDelete: Cascade)
  guildId   String  @id
  context   String? @db.VarChar(512)
  channelId String?
}

// ## Birthdays ##
model Birthday {
  userId String   @id
  date   DateTime

  members Member[]
}

// ## Moderator ##
model ModConfig {
  guild   Guild  @relation(fields: [guildId], references: [id], onDelete: Cascade)
  guildId String @unique

  logChannel String?

  automod                Boolean @default(false)
  automodDisabledFilters Json    @default("[]")
}

model Warning {
  id      Int     @unique @default(autoincrement())
  guild   Guild   @relation(fields: [guildId], references: [id], onDelete: Cascade)
  guildId String
  member  Member? @relation(fields: [guildId, userId], references: [guildId, id], onDelete: Cascade)
  userId  String

  reason String

  staffId   String
  timestamp DateTime @default(now())

  @@id([guildId, id])
}
