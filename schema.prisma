datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

// #### MAIN ####

model Guild {
  id String @id

  // Player
  playerChannel String?

  // Modules
  selfRoles SelfRolesItem[]
  warnings  Warning[]
  // effects    EffectItem[]
  // alerts     AlertsItem[]
}

// #### MODULES ####

// ## Moderator ##
model Warning {
  guild     Guild   @relation(fields: [guildId], references: [id], onDelete: Cascade)
  guildId   String
  userId    String
  number    Int

  reason String

  staffId   String
  timestamp DateTime @default(now())

  @@id([guildId, userId, number])
}

// ## Self-roles ##
model SelfRolesItem {
  name      String
  guild     Guild   @relation(fields: [guildId], references: [id], onDelete: Cascade)
  guildId   String
  channelId String?
  messageId String? @unique

  color       Int     @default(0)
  title       String  @default("Choose your role")
  description String?
  message     String?
  showHelp    Boolean @default(true)
  showName    Boolean @default(false)
  showRoles   Boolean @default(true)

  roles SelfRolesRole[]
  @@id([guildId, name])
}

model SelfRolesRole {
  roleId      String
  emoji       String?
  description String?

  item     SelfRolesItem @relation(fields: [guildId, itemName], references: [guildId, name], onDelete: Cascade)
  guildId  String
  itemName String

  @@id([guildId, itemName, roleId])
}

// ## Alerts ##
// model AlertsItem {
//   guild     Guild   @relation(references: [id], fields: [guildId], onDelete: Cascade)
//   guildId   String
//   type      String
//   name      String
//   channelId String
//   roleId    String?
//
//   @@id([guildId, type, name])
// }

// ## Effects ##
// model EffectItem {
//   id        Int     @default(autoincrement())
//   guild     Guild   @relation(references: [id], fields: [guildId], onDelete: Cascade)
//   guildId   String
//   order     Int     @default(0)
//   pattern   String
//   response  String
//   transform String?
//
//   @@id([id, guildId])
// }
